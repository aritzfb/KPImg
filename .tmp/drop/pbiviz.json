{"visual":{"name":"kPImg","displayName":"KPImg","guid":"kPImg0051F6D5AD8348148E01E9E4B31C9F41","visualClassName":"Visual","version":"1.0.0","description":"","supportUrl":"","gitHubUrl":""},"apiVersion":"2.2.0","author":{"name":"","email":""},"assets":{"icon":"assets/icon.png"},"externalJS":["node_modules/powerbi-visuals-utils-dataviewutils/lib/index.js"],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"Thrend axis","name":"category","kind":"Grouping"},{"displayName":"Value","name":"value","kind":"Measure"},{"displayName":"Target","name":"target","kind":"Measure"}],"sorting":{"implicit":{"clauses":[{"role":"category","direction":1}]}},"objects":{"visualOptions":{"displayName":"KPImg Options","properties":{"urlImgOk":{"displayName":"Image OK","type":{"text":true}},"urlImgKo":{"displayName":"Image KO","type":{"text":true}},"koPercentValue":{"displayName":"KO Percent Value","type":{"numeric":true}},"kpiColor":{"displayName":"Font Color","type":{"fill":{"solid":{"color":true}}}},"kpiTransparency":{"displayName":"Font Transparency","type":{"numeric":true}},"kpiVerticalAlign":{"displayName":"Indicator Vertical Align","type":{"enumeration":[{"value":"top","displayName":"Top"},{"value":"middle","displayName":"Middle"},{"value":"bottom","displayName":"Bottom"}]}},"serieColorOk":{"displayName":"Serie Color Ok","type":{"fill":{"solid":{"color":true}}}},"serieColorKo":{"displayName":"Serie Color Ko","type":{"fill":{"solid":{"color":true}}}},"serieColorNeutral":{"displayName":"Serie Color Neutral","type":{"fill":{"solid":{"color":true}}}},"seriesTransparency":{"displayName":"Series Transparency","type":{"numeric":true}}}},"dataPoint":{"displayName":"Data colors","properties":{"defaultColor":{"displayName":"Default color","type":{"fill":{"solid":{"color":true}}}},"showAllDataPoints":{"displayName":"Show all","type":{"bool":true}},"fill":{"displayName":"Fill","type":{"fill":{"solid":{"color":true}}}},"fillRule":{"displayName":"Color saturation","type":{"fill":{}}},"fontSize":{"displayName":"Text Size","type":{"formatting":{"fontSize":true}}}}}},"dataViewMappings":[{"conditions":[{"category":{"max":1},"value":{"max":1},"target":{"max":1}}],"categorical":{"categories":{"for":{"in":"category"},"dataReductionAlgorithm":{"top":{"count":100}}},"values":{"group":{"by":"series","select":[{"for":{"in":"value"}},{"for":{"in":"target"}}]}}}}]},"stringResources":{},"content":{"js":"var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t,e,a){void 0===t&&(t=[]);var n=t;return i(n),e&&(n.identityFields=e),a&&(n.source=a),n}function i(t,e){t.grouped=e?function(){return e}:function(){return a(t)}}function a(t){for(var e,i=[],a=0,n=t.length;n>a;a++){var r=t[a];if(!e||e.identity!==r.identity){if(e={values:[]},r.identity){e.identity=r.identity;var o=r.source;void 0!==o.groupName?e.name=o.groupName:o.displayName&&(e.name=o.displayName)}i.push(e)}e.values.push(r)}return i}t.createValueColumns=e,t.setGrouped=i,t.groupValues=a}(e=t.DataViewTransform||(t.DataViewTransform={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t,e){if(!t||!t.length)return-1;var i=t[0];if(i.values&&i.values.length>0)for(var n=0,r=i.values.length;r>n;++n){var o=i.values[n];if(o&&o.source&&a(o.source,e))return n}return-1}function i(t,e){if(t&&t.length)for(var i=0,n=t.length;n>i;i++)if(a(t[i].source,e))return i;return-1}function a(t,e){var i=t.roles;return i&&i[e]}function n(t,e){return null!=t&&null!=t.metadata&&t.metadata.columns&&t.metadata.columns.some(function(t){return t.roles&&void 0!==t.roles[e]})}function r(t,e){return t&&t.source&&t.source.roles&&t.source.roles[e]===!0}t.getMeasureIndexOfRole=e,t.getCategoryIndexOfRole=i,t.hasRole=a,t.hasRoleInDataView=n,t.hasRoleInValueColumn=r}(e=t.DataRoleHelper||(t.DataRoleHelper={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t,e,i){if(!t)return i;var a=t[e];return void 0===a?i:a}function i(t,i,a){var n=e(t,i);return n&&n.solid?n.solid.color:a}t.getValue=e,t.getFillColorByPropertyName=i}(e=t.DataViewObject||(t.DataViewObject={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e;!function(e){function i(e,i,a){return e?t.DataViewObject.getValue(e[i.objectName],i.propertyName,a):a}function a(t,e,i){return t&&t[e]?t[e]:i}function n(t,e,a){var n=i(t,e);return n&&n.solid?n.solid.color:a}function r(t,e,a){var n=i(t,e,a);return n&&n.solid?n.solid.color:void 0===n||null===n||\"object\"==typeof n&&!n.solid?a:n}e.getValue=i,e.getObject=a,e.getFillColor=n,e.getCommonValue=r}(e=t.DataViewObjects||(t.DataViewObjects={}))}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){var i,a=t.extensibility.utils.dataview.DataRoleHelper;!function(t){function e(t,e,i){if(t.categories&&t.categories.length>0){var n=t.categories[0];return n.source&&a.hasRole(n.source,e)&&a.hasRole(n.source,i)}return!1}function i(t){return void 0!==t.groupName?t.groupName:t.queryName}function n(t){var e=o(t);return null!=e&&e.imageUrl===!0}function r(t){var e=o(t);return null!=e&&e.webUrl===!0}function o(t){return t&&t.type&&t.type.misc}function s(t){return t&&t.metadata&&t.metadata.columns&&t.metadata.columns.length?t.metadata.columns.some(function(t){return n(t)===!0}):!1}t.categoryIsAlsoSeriesRole=e,t.getSeriesName=i,t.isImageUrlColumn=n,t.isWebUrlColumn=r,t.getMiscellaneousTypeDescriptor=o,t.hasImageUrlColumn=s}(i=e.converterHelper||(e.converterHelper={}))}(i=e.dataview||(e.dataview={}))}(i=e.utils||(e.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(){function e(){}return e.getDefault=function(){return new this},e.createPropertyIdentifier=function(t,e){return{objectName:t,propertyName:e}},e.parse=function(e){var i,a=this.getDefault();if(!e||!e.metadata||!e.metadata.objects)return a;i=a.getProperties();for(var n in i)for(var r in i[n]){var o=a[n][r];a[n][r]=t.DataViewObjects.getCommonValue(e.metadata.objects,i[n][r],o)}return a},e.isPropertyEnumerable=function(t){return!e.InnumerablePropertyPrefix.test(t)},e.enumerateObjectInstances=function(t,e){var i=t&&t[e.objectName];if(!i)return[];var a={objectName:e.objectName,selector:null,properties:{}};for(var n in i)i.hasOwnProperty(n)&&(a.properties[n]=i[n]);return{instances:[a]}},e.prototype.getProperties=function(){var t=this,i={},a=Object.keys(this);return a.forEach(function(a){if(e.isPropertyEnumerable(a)){var n=Object.keys(t[a]);i[a]={},n.forEach(function(t){e.isPropertyEnumerable(a)&&(i[a][t]=e.createPropertyIdentifier(a,t))})}}),i},e}();e.InnumerablePropertyPrefix=/^_/,t.DataViewObjectsParser=e}(e=t.dataview||(t.dataview={}))}(e=t.utils||(t.utils={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),powerbi;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){\"use strict\";var i=t.extensibility.utils.dataview.DataViewObjectsParser,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dataPoint=new n,e.visualOptions=new o,e}return __extends(e,t),e}(i);e.VisualSettings=a;var n=function(){function t(){this.defaultColor=\"\",this.showAllDataPoints=!0,this.fill=\"\",this.fillRule=\"\",this.fontSize=12}return t}();e.dataPointSettings=n;var r;!function(t){t[t.top=\"top\"]=\"top\",t[t.middle=\"middle\"]=\"middle\",t[t.bottom=\"bottom\"]=\"bottom\"}(r=e.alignOptions||(e.alignOptions={}));var o=function(){function t(){this.urlImgOk=\"https://s5.eestatic.com/2017/10/10/espana/Espana_253238302_49941798_1706x960.jpg\",this.urlImgKo=\"https://s4.eestatic.com/2017/10/10/espana/Espana_253237967_49932740_1706x960.jpg\",this.koPercentValue=.5,this.kpiColor=\"#000000\",this.kpiTransparency=1,this.kpiVerticalAlign=r.middle,this.serieColorOk=\"#008000\",this.serieColorKo=\"#FF0000\",this.serieColorNeutral=\"#C0C0C0\",this.seriesTransparency=.4}return t}();e.visualOptions=o}(i=e.kPImg0051F6D5AD8348148E01E9E4B31C9F41||(e.kPImg0051F6D5AD8348148E01E9E4B31C9F41={}))}(i=e.visual||(e.visual={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){\"use strict\";var e=function(){function t(){}return t}();t.myElementSerie=e;var i=function(){function i(t){this.target=t.element;var e=document.createElement(\"canvas\");this.target.appendChild(e)}return i.prototype.update=function(t){this.settings=i.parseSettings(t&&t.dataViews&&t.dataViews[0]);var a=!1,n=!1,r=!1;t&&t.dataViews&&t.dataViews[0]&&t.dataViews[0].categorical.categories&&(r=!0),t&&t.dataViews&&t.dataViews[0]&&t.dataViews[0].categorical.values&&(2==t.dataViews[0].categorical.values.length?(a=!0,n=!0):1==t.dataViews[0].categorical.values.length&&(t.dataViews[0].categorical.values[0].source.roles.value?a=!0:n=!0));var o=0,s=0,l=new Array;if(n&&a)if(r)for(var u=0;u<t.dataViews[0].categorical.categories[0].values.length;u++){var c=new e;c.name=t.dataViews[0].categorical.categories[0].values[u].valueOf().toString(),c.value=parseFloat(t.dataViews[0].categorical.values[0].values[u].valueOf().toString()),c.target=parseFloat(t.dataViews[0].categorical.values[1].values[u].valueOf().toString()),c.percent=0,0!=c.target&&(c.percent=c.value/c.target),c.percent>1&&(c.percent=1),c.percent<0&&(c.percent=0),l.push(c),o+=c.value,s+=c.target}else o=parseFloat(t.dataViews[0].categorical.values[0].values[0].valueOf().toString()),s=parseFloat(t.dataViews[0].categorical.values[1].values[0].valueOf().toString());var v=document.createElement(\"img\");if(this.settings.visualOptions.urlImgOk&&this.settings.visualOptions.urlImgKo&&this.settings.visualOptions.koPercentValue&&a&&n){var f=\"\";if(0==s||0==o)f=this.settings.visualOptions.urlImgKo.valueOf().toString();else{var p=o/s;f=p>=this.settings.visualOptions.koPercentValue?this.settings.visualOptions.urlImgOk.valueOf().toString():this.settings.visualOptions.urlImgKo.valueOf().toString()}v.setAttribute(\"src\",f)}v.onload=function(t){return function(){var e=document.getElementsByTagName(\"canvas\").item(0),i=e.getContext(\"2d\");if(i.drawImage(v,0,0,e.width,e.height),a&&n){var r=0;0!=s&&(r=o/s);var u=(100*r).toFixed(2)+\"%\";i.textAlign=\"center\";var c=e.height;c>e.width&&(c=e.height);var f=c;i.font=f.toString()+\"px sans-serif\";for(var p=i.measureText(u).width;p>e.width;)f--,i.font=f.toString()+\"px sans-serif\",p=i.measureText(u).width;if(l.length>0){if(i.beginPath(),i.moveTo(0,e.height),1==l.length)i.lineTo(0,e.height-l[0].percent*e.height),i.lineTo(e.width,e.height-l[1].percent*e.height);else for(var g=0;g<l.length;g++)i.lineTo(g*e.width/(l.length-1),e.height-l[g].percent*e.height);i.lineTo(e.width,e.height),i.globalAlpha=parseFloat(t.visualOptions.seriesTransparency.valueOf().toString()),i.closePath(),i.stroke(),i.fillStyle=t.visualOptions.serieColorNeutral.valueOf().toString(),l.length>1&&(i.fillStyle=t.visualOptions.serieColorOk.valueOf().toString(),l[l.length-1].percent<l[l.length-2].percent&&(i.fillStyle=t.visualOptions.serieColorKo.valueOf().toString())),i.fill()}var h=e.height/2+f/4;i.fillStyle=t.visualOptions.kpiColor.valueOf().toString(),i.globalAlpha=parseFloat(t.visualOptions.kpiTransparency.valueOf().toString()),\"middle\"==t.visualOptions.kpiVerticalAlign.valueOf().toString()?i.fillText(u,e.width/2,h):\"top\"==t.visualOptions.kpiVerticalAlign.valueOf().toString()?i.fillText(u,e.width/2,f/1.3):\"bottom\"==t.visualOptions.kpiVerticalAlign.valueOf().toString()?i.fillText(u,e.width/2,e.height-5):i.fillText(u,e.width/2,h)}}}(this.settings);var g=this.target.getElementsByTagName(\"canvas\").item(0);g.height=this.target.offsetHeight,g.width=this.target.offsetWidth;g.getContext(\"2d\")},i.parseSettings=function(e){return t.VisualSettings.parse(e)},i.prototype.enumerateObjectInstances=function(e){return t.VisualSettings.enumerateObjectInstances(this.settings||t.VisualSettings.getDefault(),e)},i}();t.Visual=i}(e=t.kPImg0051F6D5AD8348148E01E9E4B31C9F41||(t.kPImg0051F6D5AD8348148E01E9E4B31C9F41={}))}(e=t.visual||(t.visual={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(e){var i;!function(e){e.kPImg0051F6D5AD8348148E01E9E4B31C9F41={name:\"kPImg0051F6D5AD8348148E01E9E4B31C9F41\",displayName:\"KPImg\",\"class\":\"Visual\",version:\"1.0.0\",apiVersion:\"2.2.0\",create:function(e){return new t.extensibility.visual.kPImg0051F6D5AD8348148E01E9E4B31C9F41.Visual(e)},custom:!0}}(i=e.plugins||(e.plugins={}))}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={}));","css":".visual-kPImg0051F6D5AD8348148E01E9E4B31C9F41 p{font-size:20px;font-weight:bold}.visual-kPImg0051F6D5AD8348148E01E9E4B31C9F41 p em{background:yellow;padding:5px}","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpBOEJGMzkxN0NBRDNFMDExQTcxQ0JFODI3ODBCQUE5RSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3NEY1QjA1NUQ0OTAxMUUwQTgxREI2NjMxMkNEMUNEMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3NEY1QjA1NEQ0OTAxMUUwQTgxREI2NjMxMkNEMUNEMyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5Mjk5RDU1ODBGRDRFMDExQTcxQ0JFODI3ODBCQUE5RSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBOEJGMzkxN0NBRDNFMDExQTcxQ0JFODI3ODBCQUE5RSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpDoNX0AAAI3SURBVHjarJRLSFVRFIY9t7SiRDGLoEEPCRJRaCSYkxCiFCXCF+LIMExQLkilgumgwkbdBuWDRC2EomhURCOjgagkXEgKLUKhidobM6H0+i34rxyPnuvEA5/rXPda/1l7739vJxKJxG3ls93+hEKhTILxJhgMftmsiPxdhHw4CfepeR8dCyjWwwB0kZy3iVgCoQ2ewnmXxhrBD7Cgr/ZQVA17fDRPw2UYhzK6G99IsBse6/0QNME+H8FT4EA/YiPqOgA1q4IMzBNuw6iKjkCpj+Av+AdnEEmD3bxfhzvuDk30HaEaLsEkXCO53rN+Bwg5qsvTuj/TjGYtx9nINhRmEx7AYWiFW7AXOuEcbPOUvIZ2mnrl+PkQUbNEh4QHNKUSDdsSBWEOlmxTEfvs26FL9Khe211if6Acgee+xo7xzMgBxfq9qPe3fgWBGN2lEnqtG9nExM7CV3jp3bDos2bKJB0nHFRxAxRpA/5CIXyHh5ABv6GZqd9dJ6iz2SjbxMMypGhJFtTlNzu3kK7xgDxpove8U66FK2A+s6nul5gVVMEL+Ak7lG/T+g9JcIOGar2CRUoogxMwpP/bLTJMB9bRhDbkk5bBUU0y3ES0xS04CBfN9RSHiY90vJK0BHaSzG9h2eejS3RJeVfdtrGzuGyd8CX7Yq6ExuCH63jaVMPkFOv6OibB6DKs2+VEQp+WYBoqERn2sVWWRNN0YurIfeL14U6YkpkLYCSG6e0yqdCxvKBLIm5FgAEAV0nKuwMYRUsAAAAASUVORK5CYII="}}